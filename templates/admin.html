{% extends "layout.html" %}
{% block content %}
<div style="position: absolute; top: 10px; right: 10px; text-align: right;">
  Logged in as Admin: {{ session['admin_username'] }}<br>
  <a href="{{ url_for('admin_change_password') }}">Change Password</a><br>
  <a href="{{ url_for('admin_logout') }}">Logout</a>
</div>
<h2>Admin Dashboard</h2>

<h3>Upload Known Emails</h3>
<form method="POST" action="{{ url_for('admin_upload_emails') }}" enctype="multipart/form-data">
  <input type="file" name="emails_file" accept=".txt,.csv" required>
  <button type="submit">Upload Emails</button>
</form>

<h3>Add a Known User</h3>
<form method="POST" action="{{ url_for('admin_add_user') }}">
  <input type="email" name="new_user_email" placeholder="Enter email" required>
  <button type="submit">Add User</button>
</form>

<h3>Delete a Known User</h3>
<form method="POST" action="{{ url_for('admin_delete_user') }}">
  <input type="email" name="delete_user_email" placeholder="Enter email to delete" required>
  <button type="submit">Delete User</button>
</form>

<h3>Known Users</h3>
<ul>
  {% for user in users %}
    <li>
      {{ user.email }}
      <form method="POST" action="{{ url_for('admin_delete_user') }}" style="display:inline;">
        <input type="hidden" name="delete_user_email" value="{{ user.email }}">
        <button type="submit">Delete</button>
      </form>
    </li>
  {% endfor %}
</ul>

<h3>Meal Reservations</h3>
{% for key, group in reservations_by_slot.items() %}
  <h4>{{ key }}</h4>
  <ul>
    {% for res in group.reservations %}
      <li>
        {{ res.user_email }} (Signed up at: {{ res.timestamp }})
        <form method="POST" action="{{ url_for('admin_delete_reservation', reservation_id=res.reservation_id) }}" style="display:inline;">
          <button type="submit">Delete Reservation</button>
        </form>
      </li>
    {% endfor %}
  </ul>
{% endfor %}

<h3>Download CSV for Specific Weeks (Newest on Top)</h3>
<ul>
  {% for week in week_list %}
    <li>
      Week starting {{ week.isoformat() }}:
      <a href="{{ url_for('admin_download_meal_signups_week', week_start=week.isoformat()) }}">Download CSV</a>
    </li>
  {% endfor %}
</ul>

<h3>Download CSV for All Reservations</h3>
<a href="{{ url_for('admin_download_all_meal_signups') }}">Download CSV</a>

<h3>Add New Admin Account</h3>
<form method="POST" action="{{ url_for('admin_add_admin') }}">
  <input type="text" name="new_admin_username" placeholder="New admin username" required>
  <input type="password" name="new_admin_password" placeholder="New admin password" required>
  <button type="submit">Add Admin</button>
</form>
{% endblock %}
