{% extends "layout.html" %}
{% block content %}
<h2>Welcome, {{ session['user_email'] }}</h2>
<p><a href="{{ url_for('logout') }}">Logout</a></p>

{% if not eligible_for_pub %}
  <div style="color: red; font-weight: bold;">
    You are not eligible to sign up for pub nights this week.
  </div>
{% endif %}

<h3>Meal Signups for Next Week</h3>
<form id="mealForm" method="POST" action="{{ url_for('reserve') }}">
  <input type="hidden" id="client_timestamp" name="client_timestamp" value="">
  {% for day, slots in slots_by_date|dictsort %}
    <h4>{{ day }} ({{ day|dayname }})</h4>
    <ul>
      {% for slot in slots %}
        {% set is_pub = (slot.meal_type == 'dinner' and slot.date|weekday in [1,3]) %}
        <li>
          <label>
            <input type="checkbox" name="meal_slot" value="{{ slot.id }}"
                   data-pub="{{ 1 if is_pub else 0 }}"
                   data-capacity="{{ slot.capacity }}"
                   {% if slot.id|string in user_reservations %} checked {% endif %}
                   {% if slot.meal_type == 'dinner' and slot.date|weekday in [1,3] and not eligible_for_pub and (slot.id|string not in user_reservations) %} disabled class="not-eligible" {% endif %}>
            {{ slot.meal_type.capitalize() }} -
            <span id="count-{{ slot.id }}" data-capacity="{{ slot.capacity }}">0/{{ slot.capacity }} reservations</span>
          </label>
        </li>
      {% endfor %}
    </ul>
  {% endfor %}
  <button type="submit">Submit Reservations</button>
</form>
{% endblock %}
