{% extends "layout.html" %}
{% block content %}
<h2>Welcome, {{ session['user_email'] }}</h2>
<p><a href="{{ url_for('logout') }}">Logout</a></p>
<h3>Meal Signups for Next Week</h3>
<form id="mealForm" method="POST" action="{{ url_for('reserve') }}">
  <!-- The client timestamp will be refreshed on load, on checkbox changes, and on submit -->
  <input type="hidden" id="client_timestamp" name="client_timestamp" value="">
  
  {% for day, slots in slots_by_date|dictsort %}
    <h4>{{ day }} ({{ day|dayname }})</h4>
    <ul>
      {% for slot in slots %}
        {% set is_pub = (slot.meal_type == 'dinner' and slot.date|weekday in [1,3]) %}
        <li>
          <label>
            <input type="checkbox" name="meal_slot" value="{{ slot.id }}" data-pub="{{ 1 if is_pub else 0 }}"
              {% if slot.id in user_reservations %} disabled{% endif %}>
            {{ slot.meal_type.capitalize() }} -
            <span id="count-{{ slot.id }}">0</span> reservations
            {% if slot.id in user_reservations %}(Already reserved){% endif %}
          </label>
        </li>
      {% endfor %}
    </ul>
  {% endfor %}
  <button type="submit">Submit Reservations</button>
</form>
{% endblock %}
